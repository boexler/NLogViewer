<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:DJ"
    xmlns:nLog="clr-namespace:NLog;assembly=NLog"
    xmlns:listViewLayoutManager="clr-namespace:DJ.Helper.ListViewLayoutManager"
    xmlns:xamlMultiValueConverter="clr-namespace:DJ.XamlMultiValueConverter"
    xmlns:helper="clr-namespace:DJ.Helper"
    xmlns:xamlConverter="clr-namespace:DJ.XamlConverter"
    x:Class="DJ.Themes.GenericTheme">

    <xamlConverter:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    <xamlMultiValueConverter:ILogEventResolverToStringConverter x:Key="ILogEventResolverToStringConverter"/>

    <Style TargetType="{x:Type local:NLogViewer}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:NLogViewer}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Standard Control Group -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,5,0,5">
                            <GroupBox Header="Controls" Padding="5"
                                      Visibility="{Binding ShowControlButtons, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <ToggleButton
                                        Width="60"
                                        Height="40"
                                        IsChecked="{Binding Path=AutoScroll, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                        <ToggleButton.Content>
                                            <StackPanel Orientation="Vertical">
                                                <Image Source="../Images/Small/ScrollDown.png"
                                                       RenderOptions.BitmapScalingMode="HighQuality" Stretch="Uniform" 
                                                       Height="18" Width="18" />
                                                <TextBlock Text="Auto-Scroll" HorizontalAlignment="Center" FontSize="10" />
                                            </StackPanel>
                                        </ToggleButton.Content>
                                    </ToggleButton>
                                    <Button
                                        Margin="2,0,0,0"
                                        Width="60"
                                        Height="40"
                                        Command="{Binding Path=ClearCommand, RelativeSource={RelativeSource TemplatedParent}}">
                                        <Button.Content>
                                            <StackPanel Orientation="Vertical">
                                                <Image Source="../Images/Small/Clear.png"
                                                       RenderOptions.BitmapScalingMode="HighQuality" Stretch="Uniform" 
                                                       Height="18" Width="18" />
                                                <TextBlock Text="Clear" HorizontalAlignment="Center" FontSize="10" />
                                            </StackPanel>
                                        </Button.Content>
                                    </Button>
                                    <ToggleButton
                                        Margin="2,0,0,0"
                                        Width="60"
                                        Height="40"
                                        IsChecked="{Binding Path=Pause, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                        <ToggleButton.Content>
                                            <StackPanel Orientation="Vertical">
                                                <Image Source="../Images/Small/Pause.png"
                                                       RenderOptions.BitmapScalingMode="NearestNeighbor" Stretch="Uniform" 
                                                       Height="18" Width="18" />
                                                <TextBlock Text="Pause" HorizontalAlignment="Center" FontSize="10" />
                                            </StackPanel>
                                        </ToggleButton.Content>
                                    </ToggleButton>
                                </StackPanel>
                            </GroupBox>

                            <GroupBox Header="Filter" Margin="10,0,0,0" Padding="5"
                                      Visibility="{Binding ShowFilterButtons, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <ToggleButton
                                        Margin="0,0,2,0"
                                        Width="60"
                                        Height="40"
                                        IsChecked="{Binding Path=TraceFilter, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                        <ToggleButton.Content>
                                            <StackPanel Orientation="Vertical">
                                                <Image Source="../Images/Large/Trace.png"
                                                       RenderOptions.BitmapScalingMode="HighQuality" Stretch="Uniform" 
                                                       Height="18" Width="18" />
                                                <TextBlock Text="Trace" HorizontalAlignment="Center" FontSize="10" />
                                            </StackPanel>
                                        </ToggleButton.Content>
                                    </ToggleButton>
                                    
                                    <ToggleButton
                                        Margin="2,0,0,0"
                                        Width="60"
                                        Height="40"
                                        IsChecked="{Binding Path=DebugFilter, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                        <ToggleButton.Content>
                                            <StackPanel Orientation="Vertical">
                                                <Image Source="../Images/Large/Debug.png"
                                                       RenderOptions.BitmapScalingMode="HighQuality" Stretch="Uniform" 
                                                       Height="18" Width="18" />
                                                <TextBlock Text="Debug" HorizontalAlignment="Center" FontSize="10" />
                                            </StackPanel>
                                        </ToggleButton.Content>
                                    </ToggleButton>
                                    
                                    <ToggleButton
                                        Margin="2,0,0,0"
                                        Width="60"
                                        Height="40"
                                        IsChecked="{Binding Path=InfoFilter, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                        <ToggleButton.Content>
                                            <StackPanel Orientation="Vertical">
                                                <Image Source="../Images/Large/Info.png"
                                                       RenderOptions.BitmapScalingMode="HighQuality" Stretch="Uniform" 
                                                       Height="18" Width="18" />
                                                <TextBlock Text="Info" HorizontalAlignment="Center" FontSize="10" />
                                            </StackPanel>
                                        </ToggleButton.Content>
                                    </ToggleButton>
                                    
                                    <ToggleButton
                                        Margin="2,0,0,0"
                                        Width="60"
                                        Height="40"
                                        IsChecked="{Binding Path=WarnFilter, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                        <ToggleButton.Content>
                                            <StackPanel Orientation="Vertical">
                                                <Image Source="../Images/Large/Warning.png"
                                                       RenderOptions.BitmapScalingMode="HighQuality" Stretch="Uniform" 
                                                       Height="18" Width="18" />
                                                <TextBlock Text="Warn" HorizontalAlignment="Center" FontSize="10" />
                                            </StackPanel>
                                        </ToggleButton.Content>
                                    </ToggleButton>
                                    
                                    <ToggleButton
                                        Margin="2,0,0,0"
                                        Width="60"
                                        Height="40"
                                        IsChecked="{Binding Path=ErrorFilter, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                        <ToggleButton.Content>
                                            <StackPanel Orientation="Vertical">
                                                <Image Source="../Images/Large/Error.png"
                                                       RenderOptions.BitmapScalingMode="HighQuality" Stretch="Uniform" 
                                                       Height="18" Width="18" />
                                                <TextBlock Text="Error" HorizontalAlignment="Center" FontSize="10" />
                                            </StackPanel>
                                        </ToggleButton.Content>
                                    </ToggleButton>
                                    
                                    <ToggleButton
                                        Margin="2,0,0,0"
                                        Width="60"
                                        Height="40"
                                        IsChecked="{Binding Path=FatalFilter, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                        <ToggleButton.Content>
                                            <StackPanel Orientation="Vertical">
                                                <Image Source="../Images/Large/Fatal.png"
                                                       RenderOptions.BitmapScalingMode="HighQuality" Stretch="Uniform" 
                                                       Height="18" Width="18" />
                                                <TextBlock Text="Fatal" HorizontalAlignment="Center" FontSize="10" />
                                            </StackPanel>
                                        </ToggleButton.Content>
                                    </ToggleButton>
                                </StackPanel>
                            </GroupBox>

                            <!-- Search Controls -->
                            <GroupBox Header="Search" Margin="10,0,0,0" Padding="5"
                                      Visibility="{Binding ShowSearchControls, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibilityConverter}}">
                                <StackPanel>
                                    <!-- Search Input -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <TextBox Text="{Binding CurrentSearchText, RelativeSource={RelativeSource TemplatedParent}, UpdateSourceTrigger=PropertyChanged}"
                                                 Width="200" 
                                                 Margin="0,0,10,0"
                                                 ToolTip="Search in logger name and message content (Press Enter to add)">
                                            <TextBox.InputBindings>
                                                <KeyBinding Key="Return" Command="{Binding AddSearchTermCommand, RelativeSource={RelativeSource TemplatedParent}}"/>
                                            </TextBox.InputBindings>
                                        </TextBox>
                                        <CheckBox Content="Regex" 
                                                  IsChecked="{Binding UseRegexSearch, RelativeSource={RelativeSource TemplatedParent}}"
                                                  VerticalAlignment="Center"
                                                  ToolTip="Use regex pattern matching"/>
                                    </StackPanel>
                                    
                                    <!-- Active Search Terms -->
                                    <ItemsControl ItemsSource="{Binding ActiveSearchTerms, RelativeSource={RelativeSource TemplatedParent}}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel Orientation="Horizontal"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="LightBlue" 
                                                        BorderBrush="Blue" 
                                                        BorderThickness="1" 
                                                        CornerRadius="3" 
                                                        Margin="2" 
                                                        Padding="4,2">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="{Binding Text}" Margin="0,0,4,0"/>
                                                        <Button Content="×" 
                                                                Width="16" 
                                                                Height="16" 
                                                                FontSize="10" 
                                                                Padding="0" 
                                                                Margin="0"
                                                                Command="{Binding RemoveSearchTermCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}}"
                                                                CommandParameter="{Binding}"
                                                                ToolTip="Remove search term"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                    
                                    <!-- Clear All Button -->
                                    <Button Content="Clear All Search Terms"
                                            Command="{Binding ClearAllSearchTermsCommand, RelativeSource={RelativeSource TemplatedParent}}"
                                            Margin="0,8,0,0"
                                            HorizontalAlignment="Left"
                                            Visibility="{Binding ActiveSearchTerms.Count, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                </StackPanel>
                            </GroupBox>
                        </StackPanel>

                        <ListView
                            x:Name="PART_ListView"
                            Grid.Row="2"
                            ItemsSource="{Binding LogEvents.View, RelativeSource={RelativeSource TemplatedParent}, IsAsync=True}"
                            BorderThickness="0"
                            ScrollViewer.CanContentScroll="True"
                            listViewLayoutManager:ListViewLayoutManager.Enabled="true">
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="BorderBrush" Value="Black" />
                                    <Setter Property="BorderThickness" Value="1" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Path=Level}"
                                                     Value="{x:Static nLog:LogLevel.Trace}">
                                            <Setter Property="Background"
                                                    Value="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}, Path=TraceBackground}" />
                                            <Setter Property="Foreground"
                                                    Value="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}, Path=TraceForeground}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Path=Level}"
                                                     Value="{x:Static nLog:LogLevel.Debug}">
                                            <Setter Property="Foreground"
                                                    Value="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}, Path=DebugForeground}" />
                                            <Setter Property="Background"
                                                    Value="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}, Path=DebugBackground}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Path=Level}"
                                                     Value="{x:Static nLog:LogLevel.Info}">
                                            <Setter Property="Foreground"
                                                    Value="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}, Path=InfoForeground}" />
                                            <Setter Property="Background"
                                                    Value="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}, Path=InfoBackground}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Path=Level}"
                                                     Value="{x:Static nLog:LogLevel.Warn}">
                                            <Setter Property="Foreground"
                                                    Value="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}, Path=WarnForeground}" />
                                            <Setter Property="Background"
                                                    Value="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}, Path=WarnBackground}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Path=Level}"
                                                     Value="{x:Static nLog:LogLevel.Error}">
                                            <Setter Property="Foreground"
                                                    Value="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}, Path=ErrorForeground}" />
                                            <Setter Property="Background"
                                                    Value="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}, Path=ErrorBackground}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Path=Level}"
                                                     Value="{x:Static nLog:LogLevel.Fatal}">
                                            <Setter Property="Foreground"
                                                    Value="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}, Path=FatalForeground}" />
                                            <Setter Property="Background"
                                                    Value="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}, Path=FatalBackground}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ListView.ItemContainerStyle>
                            <ListView.View>
                                <helper:AutoSizedGridView>
                                    <GridViewColumn Header="ID" Width="40">
                                        <GridViewColumn.DisplayMemberBinding>
                                            <MultiBinding Converter="{StaticResource ILogEventResolverToStringConverter}">
                                                <Binding Path="."/>
                                                <Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}" Path="IdResolver"/>
                                            </MultiBinding>
                                        </GridViewColumn.DisplayMemberBinding>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Level" Width="Auto">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <Image x:Name="Image" RenderOptions.BitmapScalingMode="Linear"
                                                       Height="18" VerticalAlignment="Center" HorizontalAlignment="Center" />
                                                <DataTemplate.Triggers>
                                                    <DataTrigger Binding="{Binding Path=Level}"
                                                                 Value="{x:Static nLog:LogLevel.Trace}">
                                                        <Setter TargetName="Image" Property="Source"
                                                                Value="../Images/Small/Trace.png" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Path=Level}"
                                                                 Value="{x:Static nLog:LogLevel.Debug}">
                                                        <Setter TargetName="Image" Property="Source"
                                                                Value="../Images/Small/Debug.png" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Path=Level}"
                                                                 Value="{x:Static nLog:LogLevel.Info}">
                                                        <Setter TargetName="Image" Property="Source"
                                                                Value="../Images/Small/Info.png" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Path=Level}"
                                                                 Value="{x:Static nLog:LogLevel.Warn}">
                                                        <Setter TargetName="Image" Property="Source"
                                                                Value="../Images/Small/Warning.png" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Path=Level}"
                                                                 Value="{x:Static nLog:LogLevel.Error}">
                                                        <Setter TargetName="Image" Property="Source"
                                                                Value="../Images/Small/Error.png" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Path=Level}"
                                                                 Value="{x:Static nLog:LogLevel.Fatal}">
                                                        <Setter TargetName="Image" Property="Source"
                                                                Value="../Images/Small/Fatal.png" />
                                                    </DataTrigger>
                                                </DataTemplate.Triggers>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Header="TimeStamp" Width="Auto">
                                        <GridViewColumn.DisplayMemberBinding>
                                            <MultiBinding Converter="{StaticResource ILogEventResolverToStringConverter}">
                                                <Binding Path="."/>
                                                <Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}" Path="TimeStampResolver"/>
                                            </MultiBinding>
                                        </GridViewColumn.DisplayMemberBinding>
                                    </GridViewColumn>
                                    <GridViewColumn Header="LoggerName" Width="Auto">
                                        <GridViewColumn.DisplayMemberBinding>
                                            <MultiBinding Converter="{StaticResource ILogEventResolverToStringConverter}">
                                                <Binding Path="."/>
                                                <Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}" Path="LoggerNameResolver"/>
                                            </MultiBinding>
                                        </GridViewColumn.DisplayMemberBinding>
                                    </GridViewColumn>
                                    <GridViewColumn Header="Message" Width="Auto" listViewLayoutManager:RangeColumn.IsFillColumn="True">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBox
                                                    IsReadOnly="True"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    TextWrapping="Wrap"
                                                    Foreground="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ListViewItem}, Path=Foreground}">
                                                    <TextBox.Text>
                                                        <MultiBinding Converter="{StaticResource ILogEventResolverToStringConverter}">
                                                            <Binding Path="." Mode="OneWay"/>
                                                            <Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=local:NLogViewer}" Path="MessageResolver"/>
                                                        </MultiBinding>
                                                    </TextBox.Text>
                                                </TextBox>
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </helper:AutoSizedGridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>